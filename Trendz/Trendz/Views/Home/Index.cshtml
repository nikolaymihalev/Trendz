@inject ICategoryService categoryService
@inject IDiscountService discountService
@inject IProductService productService

@{
    ViewData["Title"] = "Home Page";
}

<header>    
    <section class="home-offers">
        @{
            var coupons = await discountService.GetNewestCouponsAsync(3);
            if (coupons.Any())
            {
                <i id="coupon-left-arrow" class="fa-solid fa-arrow-left" style="color: #000;"></i>
                <ul>
                @{
                    var array = new List<CouponModel>();

                    foreach (var item in coupons)
                    {
                        array.Add(item);
                    }

                    for (int i = 0; i < array.Count; i++)
                    {
                        if (i == 0)
                        {
                            <li>
                                    <a class="coupon-enabled" data-coupon-id="coupon-@i" asp-action="Discount" asp-controller="Home" asp-route-percentage="@array[i].Percentage"><img src="data:image/png;base64,@array[i].Image" /></a>
                            </li>
                        }
                        else
                        {
                            <li>
                                    <a class="coupon-disabled" data-coupon-id="coupon-@i" asp-action="Discount" asp-controller="Home" asp-route-percentage="@array[i].Percentage"><img src="data:image/png;base64,@array[i].Image" /></a>
                            </li>
                                
                        }
                    }                        
                }                    
                </ul>
                <i id="coupon-right-arrow" class="fa-solid fa-arrow-right" style="color: #000;"></i>
            }      
        }
    </section>
    <section class="top-categories">
        <ul>
            <li>
                <ul>
                    <li>                        
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Women">
                            <img src="~/images/top-category/women.png" />
                            Women
                        </a>
                    </li>
                    <li>                        
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Curve">
                            <img src="~/images/top-category/curve.png" />
                            Curve
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Kids">
                            <img src="~/images/top-category/kids.png" />
                            Kids
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Men">
                            <img src="~/images/top-category/men.png" />
                            Men
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Dresses">
                            <img src="~/images/top-category/dresses.png" />
                            Dresses
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Tops">
                            <img src="~/images/top-category/tops.png" />
                            Tops
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Beachwear">
                            <img src="~/images/top-category/beachwear.png" />
                            Beachwear
                        </a>
                    </li>
                </ul>
            </li>
            <li>
                <ul>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Home & Living">
                            <img src="~/images/top-category/home.png" />
                            Home & Living
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Beauty & Health">
                            <img src="~/images/top-category/beauty.png" />
                            Beauty & Health
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Underwear">
                            <img src="~/images/top-category/underwear.png" />
                            Underwear
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Sports">
                            <img src="~/images/top-category/sport.png" />
                            Sports
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Shoes & Bags">
                            <img src="~/images/top-category/shoes.png" />
                            Shoes & Bags
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Accessories">
                            <img src="~/images/top-category/accessories.png" />
                            Accessories
                        </a>
                    </li>
                    <li>
                        <a asp-action="Products" asp-controller="Home" asp-route-category="Electornics">
                            <img src="~/images/top-category/electronics.png" />
                            Electornics
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </section>    
    <section class="home-recommended">
        @{
            var recommProducts = await productService.GetProductsWithHighestRatingAsync(16);

            if (recommProducts.Any())
            {
                <h3>Recommended</h3>
                <ul>
                    @{
                        foreach (var item in recommProducts)
                        {
                            <li>
                                <partial name="_ProductPartial" model="item" />
                            </li>
                        }
                    }
                </ul>

                <a asp-action="Recommended" asp-controller="Home" class="show-more-btn">Show More</a>
            }
        }
    </section>
</header>

<script>
    function setCouponSectionElements() { 
        const leftArrow = document.getElementById('coupon-left-arrow');
        const rightArrow = document.getElementById('coupon-right-arrow');
        const couponsListItems = document.querySelectorAll(".home-offers ul li");

        let currentCoupon = undefined;
        let currentIndex = 0;

        couponsListItems.forEach((item) => {
            const firstChild = item.firstElementChild;
            if (firstChild.classList.contains("coupon-enabled")) {
                currentCoupon = firstChild;
                currentIndex = Number(firstChild.getAttribute("data-coupon-id").split('-')[1]);
            }
        });

        rightArrow.addEventListener('click', () => changeCurrentCoupon("plus"))

        leftArrow.addEventListener('click', () => changeCurrentCoupon("minus"))

        function changeCurrentCoupon(operation) {

            if (operation === "minus") {
                currentIndex--;
                if (currentIndex < 0) {
                    currentIndex = couponsListItems.length - 1;
                }
            } else if (operation === "plus") {
                currentIndex++;

                if (couponsListItems.length <= currentIndex) {
                    currentIndex = 0;
                }
            }         

            currentCoupon.classList.remove("coupon-enabled");
            currentCoupon.classList.add("coupon-disabled");

            let newCoupon = undefined;
            let attrName = `coupon-${currentIndex}`;

            couponsListItems.forEach((item) => {
                const firstChild = item.firstElementChild;
                if (firstChild.getAttribute("data-coupon-id") === attrName) {
                    currentCoupon = firstChild;
                    firstChild.classList.remove("coupon-disabled");
                    firstChild.classList.add("coupon-enabled");
                }
            });
        }

        setInterval(
            function () {
                changeCurrentCoupon("plus")
            },
            5000);
    }

    function changeNavSearchTitle() {
        const titleEl = document.querySelector(".nav-search form label");
        const titlesExamples = ["T-shirt", "Jeans", "Hoodie", "Dress", "Skirt", "Blouse", "Shorts", "Sweater", "Jacket", "Coat", "Tank top", "Polo shirt", "Cardigan", "Leggings", "Sweatpants", "Jumpsuit", "Romper", "Suit", "Blazer", "Vest", "Scarf", "Gloves", "Socks", "Underwear", "Bra", "Swimwear", "Bikini", "Trunks", "Pajamas", "Nightgown", "Camisole", "Corset", "Gown", "Turtleneck", "Crop top", "Overalls", "Tracksuit", "Raincoat", "Poncho", "Shawl", "Kimono", "Tunic", "Peacoat", "Windbreaker", "Henley shirt", "Rugby shirt", "Button-down shirt", "Graphic tee", "Denim jacket", "Leather jacket", "Bomber jacket", "Parka", "Maxi dress", "Midi dress", "Mini dress", "Sweatshirt", "Chinos", "Khakis", "Dress pants", "Capris", "Tights", "Overcoat", "Lingerie", "Slip dress", "Blouson", "Coveralls", "Bodysuit", "Shrug", "Tuxedo", "Culottes", "Sundress"];
           
        function getRandomNumber(max) {
            return Math.floor(Math.random() * max);
        }

        function changeTitle() {
            let index = getRandomNumber(titlesExamples.length - 1)
            titleEl.textContent = titlesExamples[index];
        }

        setInterval(
            function () {
                changeTitle()
            },
            3000);
    }


    changeNavSearchTitle();
    setCouponSectionElements();
</script>